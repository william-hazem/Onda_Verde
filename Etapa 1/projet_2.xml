<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>// Place global declarations here.
const int N = 4;         // # trains
typedef int[0,N-1] id_s;

clock time = 0;

typedef struct {
    int red;
    int green8s;
    int green;
    int yellow;
} delay_t;

chan green8S[N];
chan green[N];
chan red[N];
chan yellow[N];</declaration>
	<template>
		<name x="5" y="5">semaforo</name>
		<parameter>const id_s id, const int idAnt, const delay_t delay</parameter>
		<declaration>// Place local declarations here.
int tR= 0;
int tG = 0;
int tY = 0;

clock t_s =0;</declaration>
		<location id="id0" x="-790" y="-221">
			<name x="-807" y="-212">Red</name>
		</location>
		<location id="id1" x="-790" y="-408">
			<name x="-800" y="-442">Green_go</name>
		</location>
		<location id="id2" x="-357" y="-408">
			<name x="-367" y="-442">Green8S</name>
		</location>
		<location id="id3" x="-357" y="-221">
			<name x="-374" y="-204">Yellow</name>
		</location>
		<location id="id4" x="-960" y="-365">
			<name x="-1045" y="-399">GREEN_wait</name>
		</location>
		<init ref="id0"/>
		<transition id="id5">
			<source ref="id4"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="-942" y="-403">green[id]!</label>
		</transition>
		<transition id="id6">
			<source ref="id3"/>
			<target ref="id0"/>
			<label kind="guard" x="-646" y="-178">t_s &gt;= delay.yellow</label>
			<label kind="synchronisation" x="-595" y="-195">red[id]!</label>
			<label kind="assignment" x="-595" y="-212">t_s = 0</label>
		</transition>
		<transition id="id7">
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="guard" x="-340" y="-314">t_s &gt;= delay.green</label>
			<label kind="synchronisation" x="-323" y="-331">yellow[id]!</label>
			<label kind="assignment" x="-306" y="-348">t_s = 0</label>
		</transition>
		<transition id="id8">
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="guard" x="-637" y="-433">t_s &gt;= delay.green8s</label>
			<label kind="synchronisation" x="-603" y="-459">green8S[id]!</label>
			<label kind="assignment" x="-595" y="-476">t_s = 0</label>
		</transition>
		<transition id="id9">
			<source ref="id0"/>
			<target ref="id4"/>
			<label kind="guard" x="-1079" y="-280">t_s &gt;= delay.red</label>
			<label kind="synchronisation" x="-1079" y="-314">green8S[idAnt]?</label>
			<label kind="assignment" x="-1062" y="-331">t_s = 0</label>
			<nail x="-935" y="-272"/>
		</transition>
	</template>
	<template>
		<name>Carro</name>
		<declaration>int vel= 0;

clock t_c;</declaration>
		<location id="id10" x="-833" y="-144">
			<name x="-858" y="-178">parado</name>
		</location>
		<location id="id11" x="-552" y="-289">
			<name x="-577" y="-280">Andando</name>
		</location>
		<location id="id12" x="-144" y="-136">
			<name x="-154" y="-170">Freiando</name>
		</location>
		<init ref="id10"/>
		<transition id="id13">
			<source ref="id11"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-603" y="-433">green[3]?</label>
			<nail x="-595" y="-399"/>
			<nail x="-535" y="-399"/>
		</transition>
		<transition id="id14">
			<source ref="id11"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-595" y="-484">green[2]?</label>
			<nail x="-646" y="-450"/>
			<nail x="-493" y="-459"/>
		</transition>
		<transition id="id15">
			<source ref="id11"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-586" y="-535">green[1]?</label>
			<nail x="-714" y="-501"/>
			<nail x="-433" y="-510"/>
		</transition>
		<transition id="id16">
			<source ref="id11"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-595" y="-595">green[0]?</label>
			<nail x="-799" y="-561"/>
			<nail x="-357" y="-561"/>
		</transition>
		<transition id="id17">
			<source ref="id11"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-136" y="-433">yellow[0]?</label>
			<label kind="assignment" x="-136" y="-416">vel -= 10</label>
			<nail x="-442" y="-365"/>
			<nail x="-161" y="-272"/>
		</transition>
		<transition id="id18">
			<source ref="id11"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-34" y="-433">yellow[1]?</label>
			<label kind="assignment" x="-34" y="-416">vel -= 10</label>
			<nail x="-442" y="-348"/>
			<nail x="-170" y="-255"/>
		</transition>
		<transition id="id19">
			<source ref="id11"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-136" y="-382">yellow[2]?</label>
			<label kind="assignment" x="-136" y="-365">vel -= 10</label>
			<nail x="-433" y="-331"/>
			<nail x="-170" y="-238"/>
		</transition>
		<transition id="id20">
			<source ref="id11"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-34" y="-382">yellow[3]?</label>
			<label kind="assignment" x="-34" y="-365">vel -= 10</label>
			<nail x="-433" y="-314"/>
			<nail x="-178" y="-221"/>
		</transition>
		<transition id="id21">
			<source ref="id12"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-357" y="-9">red[0]?</label>
			<label kind="assignment" x="-357" y="8">vel = 0</label>
			<nail x="-535" y="-127"/>
			<nail x="-705" y="-170"/>
		</transition>
		<transition id="id22">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-892" y="-340">green[3]?</label>
			<label kind="assignment" x="-892" y="-323">vel += 10</label>
			<nail x="-799" y="-187"/>
			<nail x="-595" y="-289"/>
		</transition>
		<transition id="id23">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-994" y="-391">green[0]?</label>
			<label kind="assignment" x="-994" y="-374">vel += 10</label>
			<nail x="-850" y="-229"/>
			<nail x="-620" y="-348"/>
		</transition>
		<transition id="id24">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-994" y="-340">green[1]?</label>
			<label kind="assignment" x="-986" y="-323">vel += 10</label>
			<nail x="-833" y="-212"/>
			<nail x="-833" y="-229"/>
			<nail x="-620" y="-331"/>
		</transition>
		<transition id="id25">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-884" y="-391">green[2]?</label>
			<label kind="assignment" x="-884" y="-374">vel += 10</label>
			<nail x="-816" y="-212"/>
			<nail x="-612" y="-306"/>
		</transition>
		<transition id="id26">
			<source ref="id12"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-280" y="42">red[3]?</label>
			<label kind="assignment" x="-280" y="59">vel = 0</label>
			<nail x="-544" y="-42"/>
			<nail x="-697" y="-85"/>
		</transition>
		<transition id="id27">
			<source ref="id12"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-357" y="42">red[2]?</label>
			<label kind="assignment" x="-357" y="59">vel = 0</label>
			<nail x="-544" y="-76"/>
			<nail x="-688" y="-119"/>
		</transition>
		<transition id="id28">
			<source ref="id12"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-280" y="-9">red[1]?</label>
			<label kind="assignment" x="-280" y="8">vel = 0</label>
			<nail x="-544" y="-102"/>
			<nail x="-697" y="-144"/>
		</transition>
		<transition id="id29">
			<source ref="id12"/>
			<target ref="id12"/>
			<label kind="assignment" x="-68" y="-127">vel -= 10</label>
			<nail x="-76" y="-102"/>
			<nail x="-76" y="-136"/>
		</transition>
		<transition id="id30">
			<source ref="id12"/>
			<target ref="id10"/>
			<label kind="assignment" x="-577" y="-25">vel = 0</label>
			<nail x="-467" y="-25"/>
			<nail x="-637" y="-25"/>
		</transition>
		<transition id="id31">
			<source ref="id11"/>
			<target ref="id11"/>
			<label kind="assignment" x="-586" y="-212">vel += 10</label>
			<nail x="-501" y="-221"/>
			<nail x="-595" y="-221"/>
		</transition>
		<transition id="id32">
			<source ref="id11"/>
			<target ref="id12"/>
			<label kind="assignment" x="-399" y="-255">vel -= 10</label>
		</transition>
		<transition id="id33">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="assignment" x="-705" y="-238">vel += 10</label>
		</transition>
	</template>
	<template>
		<name>Iniciar</name>
		<parameter>const int id</parameter>
		<declaration>clock t=0;</declaration>
		<location id="id34" x="-161" y="-17">
		</location>
		<location id="id35" x="0" y="-17">
		</location>
		<init ref="id34"/>
		<transition id="id36">
			<source ref="id34"/>
			<target ref="id35"/>
			<label kind="synchronisation" x="-127" y="-42">green8S[id]!</label>
		</transition>
	</template>
	<system>const int id0 = 0;
const int id1 = 1;
const int id2 = 2;
const int id3 = 3;


const delay_t delay = {10, 8, 12, 2};

S1 = semaforo(id0 , id3, delay);
S2 = semaforo(id1 , id0, delay);
S3 = semaforo(id2 , id1, delay);
S4 = semaforo(id3 , id2, delay);
start = Iniciar(id3);
c = Carro();


system S1, S2, S3, S4, start, c;
</system>
	<queries>
		<query>
			<formula/>
			<comment/>
		</query>
	</queries>
</nta>
